<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Prof√©tica Adaptativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 50vh; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 40vh; max-height: 400px; } }
        .gemini-result { white-space: pre-wrap; background-color: #f8f9fa; border-left: 3px solid #003F5C; padding: 1rem; border-radius: 0.25rem; margin-top: 1rem; font-size: 0.9rem; color: #333; text-align: left; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #FF6361; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 1rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in-section { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }
        .tts-button:disabled, .action-button:disabled, .interactive-layer:disabled { opacity: 0.5; cursor: not-allowed; }
        #danielImageContainer img, #multimodalPreview, .dynamic-image { border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-top: 1rem; max-height: 400px; width: auto; object-fit: contain; margin-left: auto; margin-right: auto; }
        #multimodalPreview { max-height: 250px; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <nav class="sticky top-0 bg-white/80 backdrop-blur-md shadow-md z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <h2 class="text-lg md:text-xl font-bold text-[#003F5C]">An√°lise Adaptativa</h2>
                <div id="auth-container">
                    <button id="loginBtn" class="bg-[#003F5C] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#002A3D] transition-colors">Login</button>
                    <div id="userInfo" class="hidden items-center">
                        <p id="userIdDisplay" class="text-sm text-gray-600 mr-2 md:mr-4"></p>
                        <button id="logoutBtn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12 md:mb-16 fade-in-section">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-black text-[#003F5C] uppercase tracking-wider">An√°lise Prof√©tica na Era Tecnol√≥gica</h1>
            <p class="text-md md:text-lg text-[#366E8A] mt-2">Uma explora√ß√£o aprofundada sobre a converg√™ncia de poder, tecnologia e narrativas antigas.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

            <section id="section-daniel" class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#58508d] fade-in-section" role="region" aria-labelledby="daniel-title">
                 <div class="flex justify-between items-start">
                    <h2 id="daniel-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">A Est√°tua de Daniel: Paradigma de Imp√©rios</h2>
                    <button class="tts-button" onclick="playTextFromSection('section-daniel-content')" aria-label="Ouvir an√°lise da Est√°tua de Daniel"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#58508d] hover:text-[#3e3869]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                 </div>
                <div id="section-daniel-content" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                    <div>
                        <p class="text-gray-700 mb-4">A vis√£o da est√°tua em Daniel 2 descreve uma sucess√£o de imp√©rios, servindo como modelo para analisar a ascens√£o e queda de pot√™ncias globais.</p>
                        <ul class="space-y-2 text-gray-700">
                            <li><span class="font-bold text-[#bc5090]">üëë Ouro:</span> Imp√©rio Babil√¥nico</li>
                            <li><span class="font-bold text-[#ff6361]">ü•à Prata:</span> Imp√©rio Medo-Persa</li>
                            <li><span class="font-bold text-[#ffa600]">ü•â Bronze:</span> Imp√©rio Grego</li>
                            <li><span class="font-bold text-[#58508d]">‚õìÔ∏è Ferro:</span> Imp√©rio Romano</li>
                            <li><span class="font-bold text-gray-500">üß±+‚õìÔ∏è Ferro e Barro:</span> Fase final de poder dividido.</li>
                        </ul>
                    </div>
                    <div class="text-center">
                        <div id="danielImageContainer" class="min-h-[300px] bg-gray-100 rounded-lg flex items-center justify-center p-4">
                            <img src="https://blogdoseualipio.com.br/wp-content/uploads/2018/09/Daniel-2-696x625.jpg" alt="Ilustra√ß√£o da est√°tua do sonho de Nabucodonosor, de Daniel 2."/>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-fire" class="md:col-span-2 lg:col-span-2 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#FFA600] fade-in-section" role="region" aria-labelledby="fire-title">
                 <div class="flex justify-between items-start">
                    <h2 id="fire-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">O "Fogo dos C√©us" & a Conquista do Espa√ßo üî•</h2>
                     <button class="tts-button" onclick="playTextFromSection('section-fire-content')" aria-label="Ouvir an√°lise sobre fogo dos c√©us"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#FFA600] hover:text-[#E69500]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                 </div>
                <div id="section-fire-content">
                    <p class="text-gray-600 mb-6">A reutiliza√ß√£o de foguetes (Apoc. 13:13) √© uma revolu√ß√£o estrat√©gica que barateou o acesso ao espa√ßo, permitindo a constru√ß√£o de mega-constela√ß√µes de sat√©lites.</p>
                    <div class="chart-container"><canvas id="annualLandingsChart"></canvas></div>
                    <p class="text-center text-sm text-gray-500 mt-2">Aterrissagens anuais bem-sucedidas, mostrando a acelera√ß√£o da cad√™ncia.</p>
                </div>
                 <div class="mt-6 text-center">
                    <button id="analyzeFire" class="action-button bg-[#FFA600] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#E69500] transition-colors">‚ú® Aprofundar An√°lise</button>
                    <div id="fireAnalysisLoader" class="loader hidden"></div>
                    <div id="fireAnalysisResult" class="gemini-result hidden" aria-live="polite"></div>
                </div>
                <div id="note-container-fire" class="mt-6 hidden"></div>
            </section>
            
            <section id="section-satellites" class="md:col-span-2 lg:col-span-1 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#00bfa5] fade-in-section" role="region" aria-labelledby="satellites-title">
                <div class="flex justify-between items-start">
                    <h2 id="satellites-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">A Teia Global: Soberania em √ìrbita üõ∞Ô∏è</h2>
                    <button class="tts-button" onclick="playTextFromSection('section-satellites-content')" aria-label="Ouvir an√°lise sobre sat√©lites"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#00bfa5] hover:text-[#008c7a]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                </div>
                <div id="section-satellites-content">
                    <p class="text-gray-600 mb-6">Controlar a √≥rbita baixa com milhares de sat√©lites interconectados estabelece uma nova camada de soberania com poder sem precedentes. Clique nas camadas para aprofundar a an√°lise:</p>
                    
                    <div id="interactive-layers" class="space-y-2">
                        <div>
                            <button id="layer-application" class="interactive-layer w-full text-left bg-blue-100 text-blue-800 p-3 rounded-lg shadow-sm hover:bg-blue-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <span class="font-bold">Aplica√ß√£o</span> (Servi√ßos: GPS, Internet)
                            </button>
                            <div id="layer-application-analysis" class="hidden p-4">
                                <div id="layer-application-loader" class="loader hidden"></div>
                                <div id="layer-application-image" class="mb-4"></div>
                                <div id="layer-application-result" class="gemini-result" aria-live="polite"></div>
                            </div>
                        </div>

                        <div>
                            <button id="layer-data" class="interactive-layer w-full text-left bg-green-100 text-green-800 p-3 rounded-lg shadow-sm hover:bg-green-200 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500">
                                <span class="font-bold">Dados</span> (Fluxo de Informa√ß√£o Global)
                            </button>
                             <div id="layer-data-analysis" class="hidden p-4">
                                <div id="layer-data-loader" class="loader hidden"></div>
                                <div id="layer-data-result" class="gemini-result" aria-live="polite"></div>
                            </div>
                        </div>

                        <div>
                             <button id="layer-physical" class="interactive-layer w-full text-left bg-gray-200 text-gray-800 p-3 rounded-lg shadow-sm hover:bg-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500">
                                <span class="font-bold">F√≠sica</span> (Constela√ß√£o de Sat√©lites)
                            </button>
                            <div id="layer-physical-analysis" class="hidden p-4">
                                <div id="layer-physical-loader" class="loader hidden"></div>
                                <div id="layer-physical-result" class="gemini-result" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="note-container-satellites" class="mt-6 hidden"></div>
            </section>

            <section id="section-bci" class="md:col-span-1 lg:col-span-2 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#ff6361] fade-in-section" role="region" aria-labelledby="bci-title">
                 <div class="flex justify-between items-start">
                    <h2 id="bci-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">A Interface C√©rebro-M√°quina üß†</h2>
                    <button class="tts-button" onclick="playTextFromSection('section-bci-content')" aria-label="Ouvir an√°lise sobre Interface C√©rebro-M√°quina"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#ff6361] hover:text-[#e65a58]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                 </div>
                <div id="section-bci-content">
                    <p class="text-gray-600 mb-6">A simbiose entre mente humana e IA (BCI) promete curar doen√ßas, mas tamb√©m abre a porta para o aprimoramento humano e conex√£o direta com redes digitais.</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li><b>Objetivo M√©dico:</b> Restaurar vis√£o, mobilidade e tratar doen√ßas (Parkinson).</li>
                        <li><b>Potencial Futurista:</b> Comunica√ß√£o telep√°tica sint√©tica, controle de dispositivos.</li>
                        <li><b>Quest√£o Filos√≥fica:</b> O que nos define quando a biologia e a m√°quina se fundem?</li>
                    </ul>
                </div>
                <div id="note-container-bci" class="mt-6 hidden"></div>
            </section>

            <section id="section-numerology" class="md:col-span-1 lg:col-span-1 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#bc5090] fade-in-section" role="region" aria-labelledby="numerology-title">
                <div class="flex justify-between items-start">
                    <h2 id="numerology-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">An√°lise Cripto-Numerol√≥gica üî¢</h2>
                    <button class="tts-button" onclick="playTextFromSection('section-numerology-content')" aria-label="Ouvir an√°lise numerol√≥gica"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#bc5090] hover:text-[#a3467d]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                </div>
                <div id="section-numerology-content">
                    <p class="text-gray-600 mb-4">Explore o simbolismo num√©rico de nomes e conceitos usando sistemas antigos como a numerologia Caldeia.</p>
                    <input type="text" id="numerologyInput" class="w-full p-2 border rounded-md" placeholder="Ex: Elon Musk">
                </div>
                <div class="text-center mt-4">
                    <button id="analyzeNumerology" class="action-button bg-[#bc5090] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#a3467d] transition-colors">‚ú® Analisar Valor</button>
                    <div id="numerologyLoader" class="loader hidden"></div>
                    <div id="numerologyResult" class="gemini-result hidden" aria-live="polite"></div>
                </div>
                <div id="note-container-numerology" class="mt-6 hidden"></div>
            </section>

            <section id="section-multimodal" class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#003F5C] fade-in-section" role="region" aria-labelledby="multimodal-title">
                <div class="flex justify-between items-start">
                     <h2 id="multimodal-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">An√°lise Multimodal de S√≠mbolos üñºÔ∏è</h2>
                     <button class="tts-button" onclick="playTextFromSection('section-multimodal-content')" aria-label="Ouvir an√°lise multimodal"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#003F5C] hover:text-[#002A3D]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                </div>
                <div id="section-multimodal-content" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <p class="text-gray-600 mb-4">Envie uma imagem (logo, foto, arte) e pe√ßa √† IA para analis√°-la dentro do contexto tem√°tico desta investiga√ß√£o, identificando s√≠mbolos e correla√ß√µes.</p>
                        <input type="file" id="imageUpload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#366E8A] file:text-white hover:file:bg-[#2a556b]">
                        <input type="text" id="multimodalPrompt" class="w-full p-2 border rounded-md mt-4" placeholder="Sua pergunta sobre a imagem">
                    </div>
                    <div class="text-center">
                        <img id="multimodalPreview" src="https://placehold.co/400x250/e2e8f0/adb5bd?text=Aperitivo+da+Imagem" alt="Pr√©-visualiza√ß√£o da imagem enviada.">
                    </div>
                </div>
                 <div class="text-center mt-6">
                    <button id="analyzeImage" class="action-button bg-[#003F5C] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#002A3D] transition-colors">‚ú® Analisar Imagem</button>
                    <div id="multimodalLoader" class="loader hidden"></div>
                    <div id="multimodalResult" class="gemini-result hidden" aria-live="polite"></div>
                </div>
                <div id="note-container-multimodal" class="mt-6 hidden"></div>
            </section>
            
            <section id="section-scenarios" class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-xl p-6 md:p-8 border-t-4 border-[#7A9EAF] fade-in-section" role="region" aria-labelledby="scenarios-title">
                <div class="flex justify-between items-start">
                    <h2 id="scenarios-title" class="text-xl md:text-2xl font-bold text-[#003F5C] mb-4 flex-grow">Cen√°rios Futuros üîÆ</h2>
                     <button class="tts-button" onclick="playTextFromSection('section-scenarios-content')" aria-label="Ouvir cen√°rios futuros"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#7A9EAF] hover:text-[#5c7a8a]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a1 1 0 00-1.414 1.414L15.536 18.38l-1.415-1.414a7 7 0 00-9.9-9.9L5.858 5.858zM12 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                </div>
                <div id="section-scenarios-content">
                    <p class="text-gray-600 mb-6">Use a IA para extrapolar as tend√™ncias atuais e gerar cen√°rios futuros plaus√≠veis, explorando para onde a converg√™ncia tecnol√≥gica pode nos levar.</p>
                </div>
                <div class="text-center">
                    <button id="generateScenarios" class="action-button bg-[#003F5C] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#002A3D] transition-colors">Gerar Cen√°rios com IA</button>
                    <div id="scenariosLoader" class="loader hidden"></div>
                    <div id="scenariosResult" class="gemini-result hidden" aria-live="polite"></div>
                </div>
                <div id="note-container-scenarios" class="mt-6 hidden"></div>
            </section>

            <div class="md:col-span-2 lg:col-span-3 bg-[#003F5C] text-white rounded-lg shadow-xl p-8 fade-in-section">
                <h2 class="text-2xl font-bold text-center mb-4">Conclus√£o da An√°lise</h2>
                <p class="text-center text-gray-200">Esta an√°lise apresentou correla√ß√µes factuais entre textos antigos e a acelera√ß√£o tecnol√≥gica, sem afirmar causalidade. A converg√™ncia de poder no espa√ßo, na comunica√ß√£o e na biologia humana representa um ponto de inflex√£o hist√≥rico. O discernimento individual √© a ferramenta final.</p>
                <p class="text-center mt-4 text-gray-300 italic">"Examinando cada dia nas Escrituras se estas coisas eram assim." - Atos 17:11</p>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let userId = null;
        let noteUnsubscribe = {};

        const apiKey = "";
        const geminiApiTextUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const imageApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
        const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

        // --- FUN√á√ïES DE API GEN√âRICAS ---
        async function callTextAPI(prompt, loaderElement, resultElement) {
            loaderElement.classList.remove('hidden');
            resultElement.classList.add('hidden');
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            try {
                const response = await fetch(geminiApiTextUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if(!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                resultElement.textContent = text || "N√£o foi poss√≠vel obter uma an√°lise.";
                return text;
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                resultElement.textContent = "Erro ao conectar com a API de IA.";
            } finally {
                loaderElement.classList.add('hidden');
                resultElement.classList.remove('hidden');
            }
        }

        async function callImageAPI(prompt, imageContainer) {
            imageContainer.innerHTML = '';
            const payload = { instances: [{ prompt }], parameters: { "sampleCount": 1 } };
            try {
                const response = await fetch(imageApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const result = await response.json();
                if (result.predictions?.[0]?.bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    imageContainer.innerHTML = `<img src="${imageUrl}" class="dynamic-image" alt="Imagem gerada por IA.">`;
                } else { throw new Error("Resposta da API de imagem inv√°lida."); }
            } catch(error) {
                console.error("Erro ao gerar imagem:", error);
                imageContainer.innerHTML = '<p class="text-red-500">Falha ao gerar a imagem.</p>';
            }
        }
        
        // --- AN√ÅLISE NUMEROL√ìGICA ---
        document.getElementById('analyzeNumerology').addEventListener('click', () => {
            const input = document.getElementById('numerologyInput').value;
            if (!input.trim()) { alert('Por favor, insira um nome ou conceito.'); return; }
            const prompt = `Aja como um especialista em numerologia antiga. Explique brevemente o sistema Caldeu e, em seguida, calcule o valor numerol√≥gico para "${input}", mostrando o mapeamento de cada letra para seu n√∫mero e a soma passo a passo. Seja frio e anal√≠tico. Responda em Portugu√™s.`;
            callTextAPI(prompt, document.getElementById('numerologyLoader'), document.getElementById('numerologyResult'));
        });

        // --- AN√ÅLISE MULTIMODAL ---
        let uploadedImageBase64 = null;
        document.getElementById('imageUpload').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('multimodalPreview').src = e.target.result;
                    uploadedImageBase64 = e.target.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('analyzeImage').addEventListener('click', async () => {
            const promptText = document.getElementById('multimodalPrompt').value;
            if (!uploadedImageBase64) { alert('Por favor, fa√ßa o upload de uma imagem primeiro.'); return; }
            if (!promptText.trim()) { alert('Por favor, insira uma pergunta sobre a imagem.'); return; }

            const loader = document.getElementById('multimodalLoader');
            const resultEl = document.getElementById('multimodalResult');
            loader.classList.remove('hidden');
            resultEl.classList.add('hidden');
            
            const payload = { contents: [{ parts: [{ text: promptText }, { inline_data: { mime_type: "image/jpeg", data: uploadedImageBase64 } }] }] };

            try {
                const response = await fetch(geminiApiTextUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                resultEl.textContent = text || "An√°lise n√£o dispon√≠vel.";
            } catch (error) {
                console.error("Multimodal analysis error:", error);
                resultEl.textContent = "Erro ao analisar a imagem.";
            } finally {
                loader.classList.add('hidden');
                resultEl.classList.remove('hidden');
            }
        });
        
        // --- TTS ---
        let audioContext; let currentAudioSource = null;
        const base64ToArrayBuffer = (base64) => { const binaryString = window.atob(base64); const len = binaryString.length; const bytes = new Uint8Array(len); for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); } return bytes.buffer; };
        const pcmToWav = (pcmData, sampleRate) => { const pcm16 = new Int16Array(pcmData); const view = new DataView(new ArrayBuffer(44)); view.setUint32(0, 0x52494646, false); view.setUint32(4, 36 + pcm16.byteLength, true); view.setUint32(8, 0x57415645, false); view.setUint32(12, 0x666d7420, false); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true); view.setUint16(34, 16, true); view.setUint32(36, 0x64617461, false); view.setUint32(40, pcm16.byteLength, true); return new Blob([view, pcm16], { type: 'audio/wav' }); };
        window.playTextFromSection = async (sectionContentId) => {
            const textToSpeak = document.getElementById(sectionContentId)?.innerText.trim();
            if (!textToSpeak) return;
            const button = document.getElementById(sectionContentId).closest('section').querySelector('.tts-button');
            const originalIcon = button.innerHTML;
            button.disabled = true; button.innerHTML = `<div class="w-6 h-6 loader !border-t-[#003F5C]"></div>`;
            if (currentAudioSource) currentAudioSource.stop();
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            try {
                const payload = { contents: [{ parts: [{ text: textToSpeak }] }], generationConfig: { responseModalities: ["AUDIO"] }, model: "gemini-2.5-flash-preview-tts" };
                const response = await fetch(ttsApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                const result = await response.json();
                const audioData = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                const mimeType = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;
                if (audioData && mimeType?.startsWith("audio/")) {
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)?.[1] || "24000", 10);
                    const wavBlob = pcmToWav(base64ToArrayBuffer(audioData), sampleRate);
                    const audioBuffer = await audioContext.decodeAudioData(await (await fetch(URL.createObjectURL(wavBlob))).arrayBuffer());
                    currentAudioSource = audioContext.createBufferSource(); currentAudioSource.buffer = audioBuffer; currentAudioSource.connect(audioContext.destination); currentAudioSource.start(0);
                    currentAudioSource.onended = () => { button.disabled = false; button.innerHTML = originalIcon; };
                } else { throw new Error("No audio data."); }
            } catch (error) { console.error("TTS Error:", error); button.disabled = false; button.innerHTML = originalIcon; }
        };

        // --- AUTH E NOTAS ---
        onAuthStateChanged(auth, user => {
            userId = user?.uid;
            document.getElementById('loginBtn').classList.toggle('hidden', !!user);
            document.getElementById('userInfo').classList.toggle('hidden', !user);
            if(user) {
                document.getElementById('userIdDisplay').textContent = `ID: ${userId.substring(0, 4)}...${userId.substring(userId.length-4)}`;
                setupNoteTaking();
            } else { cleanupNoteTaking(); }
        });
        document.getElementById('loginBtn').addEventListener('click', () => signInAnonymously(auth).catch(e => console.error(e)));
        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));
        
        const noteSections = ['fire', 'satellites', 'bci', 'numerology', 'multimodal', 'scenarios'];
        function setupNoteTaking() { noteSections.forEach(id => { const c = document.getElementById(`note-container-${id}`); if (!c) return; c.classList.remove('hidden'); c.innerHTML = `<h4 class="font-bold text-lg text-[#003F5C] mb-2">Sua An√°lise Pessoal</h4><textarea id="note-input-${id}" class="w-full p-2 border rounded-md" placeholder="Escreva sua reflex√£o..."></textarea><button id="note-save-${id}" class="mt-2 bg-[#366E8A] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#2a556b]">Salvar</button><p id="note-status-${id}" class="text-sm text-gray-500 mt-1"></p>`; const noteRef = doc(db, 'artifacts', appId, 'users', userId, 'notes', id); const i = document.getElementById(`note-input-${id}`); const s = document.getElementById(`note-save-${id}`); const st = document.getElementById(`note-status-${id}`); noteUnsubscribe[id] = onSnapshot(noteRef, (d) => { i.value = d.exists() ? d.data().text : ''; }); s.addEventListener('click', () => { setDoc(noteRef, { text: i.value }, { merge: true }).then(() => { st.textContent = 'Salvo!'; setTimeout(() => st.textContent = '', 2000); }).catch(e => { st.textContent = 'Erro.'; console.error(e); }); }); }); }
        function cleanupNoteTaking() { noteSections.forEach(id => { const c = document.getElementById(`note-container-${id}`); if (c) c.classList.add('hidden'); if (noteUnsubscribe[id]) noteUnsubscribe[id](); }); }

        // --- ANIMA√á√ÉO DE SCROLL ---
        const faders = document.querySelectorAll('.fade-in-section');
        const appearOnScroll = new IntersectionObserver((entries, o) => { entries.forEach(e => { if (!e.isIntersecting) return; e.target.classList.add('is-visible'); o.unobserve(e.target); }); }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });
        faders.forEach(f => appearOnScroll.observe(f));
        
        // --- GR√ÅFICOS ---
        const tooltipTitleCallback = (i) => { let l = i[0].chart.data.labels[i[0].dataIndex]; return Array.isArray(l) ? l.join(' ') : l; };
        const chartPlugins = { legend: { labels: { color: '#003F5C' } }, tooltip: { callbacks: { title: tooltipTitleCallback } } };

        new Chart(document.getElementById('annualLandingsChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
                datasets: [{
                    label: 'Aterrissagens Anuais Bem-sucedidas',
                    data: [18, 21, 20, 26, 31, 61, 102, 119], 
                    backgroundColor: '#FFA600'
                }]
            },
            options: { maintainAspectRatio: false, responsive: true, plugins: chartPlugins, scales: { y: { beginAtZero: true, ticks: { color: '#003F5C' } }, x: { ticks: { color: '#003F5C' } } } }
        });

        // --- BOT√ïES DE A√á√ÉO ---
        document.getElementById('analyzeFire').addEventListener('click', () => {
             const prompt = `Analise o impacto estrat√©gico e geopol√≠tico da tecnologia de foguetes reutiliz√°veis. Apresente os dados de aterrissagens anuais (18 em 2017, 21 em 2018, 20 em 2019, 26 em 2020, 31 em 2021, 61 em 2022, 102 em 2023, 119 em 2024) e, em seguida, analise a curva de crescimento cumulativo, que atingiu mais de 400 aterrissagens at√© o final de 2024, focando em como essa acelera√ß√£o exponencial altera o equil√≠brio de poder no acesso ao espa√ßo. Responda em Portugu√™s.`;
            callTextAPI(prompt, document.getElementById('fireAnalysisLoader'), document.getElementById('fireAnalysisResult'))
        });
        document.getElementById('generateScenarios').addEventListener('click', () => callTextAPI("Com base na converg√™ncia de mega-constela√ß√µes de sat√©lites, interfaces c√©rebro-computador e IA, gere tr√™s cen√°rios distintos para a sociedade em 2084: um ut√≥pico (Cen√°rio Aurora), um dist√≥pico (Cen√°rio Nexus) e um de equil√≠brio complexo (Cen√°rio Kintsugi). Responda em Portugu√™s.", document.getElementById('scenariosLoader'), document.getElementById('scenariosResult')));

        // --- L√ìGICA DAS CAMADAS INTERATIVAS ---
        const layers = [
            { id: 'application', prompt: 'Analise como a onipresen√ßa de servi√ßos de GPS e internet via sat√©lite impacta a soberania nacional e a vida cotidiana. Responda em Portugu√™s.', imagePrompt: 'Uma visualiza√ß√£o art√≠stica do planeta Terra coberto por uma teia brilhante de conex√µes de dados, com feixes de luz representando sinais de GPS e internet. Estilo futurista e abstrato.' },
            { id: 'data', prompt: 'Descreva o fluxo de informa√ß√£o global via sat√©lite como o novo sistema nervoso digital do planeta, abordando suas implica√ß√µes para economia, vigil√¢ncia e poder. Responda em Portugu√™s.' },
            { id: 'physical', prompt: 'Explique a import√¢ncia estrat√©gica e militar de dominar a √ìrbita Baixa da Terra (LEO) com uma constela√ß√£o de milhares de sat√©lites. Responda em Portugu√™s.' }
        ];

        layers.forEach(layer => {
            const button = document.getElementById(`layer-${layer.id}`);
            const analysisContainer = document.getElementById(`layer-${layer.id}-analysis`);
            const loader = document.getElementById(`layer-${layer.id}-loader`);
            const resultEl = document.getElementById(`layer-${layer.id}-result`);
            const imageContainer = document.getElementById(`layer-${layer.id}-image`);

            button.addEventListener('click', async () => {
                const isHidden = analysisContainer.classList.toggle('hidden');
                if (!isHidden) {
                    button.disabled = true;
                    // L√≥gica para chamar as APIs
                    const textPromise = callTextAPI(layer.prompt, loader, resultEl);
                    const imagePromise = layer.imagePrompt ? callImageAPI(layer.imagePrompt, imageContainer) : Promise.resolve();

                    await Promise.all([textPromise, imagePromise]);
                    button.disabled = false;
                }
            });
        });

    </script>
</body>
</html>

